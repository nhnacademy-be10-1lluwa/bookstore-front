<!DOCTYPE html>
<html layout:decorate="~{layout/layout}"
      th:lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head layout:fragment="head" title="νμ› λ©λ΅">
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/page/member/_member-list.css}" />
</head>

<body>
<main layout:fragment="content">
    <section class="main-content">
        <div class="header-row">
            <h2 class="title">π“‹ μ „μ²΄ νμ›λ©λ΅</h2>
        </div>

        <p th:if="${selectedGrade != null}">
            β… ν„μ¬ μ„ νƒλ λ“±κΈ‰: <strong th:text="${selectedGrade}"></strong>
        </p>

        <!-- λ“±κΈ‰ ν•„ν„° λ° ν¬μΈνΈ μ§€κΈ‰ νΌ -->
        <div class="filter-section">
            <!-- ν•„ν„° -->
            <form method="get" action="/admin/member-list">
                <label>
                    <select name="grade" onchange="this.form.submit()">
                        <option value="">μ „μ²΄ λ“±κΈ‰</option>
                        <option value="BASIC" th:selected="${selectedGrade == 'BASIC'}">μΌλ°</option>
                        <option value="GOLD" th:selected="${selectedGrade == 'GOLD'}">κ³¨λ“</option>
                        <option value="ROYAL" th:selected="${selectedGrade == 'ROYAL'}">λ΅μ–„</option>
                        <option value="PLATINUM" th:selected="${selectedGrade == 'PLATINUM'}">ν”λν‹°λ„</option>
                    </select>
                </label>
            </form>

            <!-- ν¬μΈνΈ μ§€κΈ‰ -->
            <form id="pointForm" method="post" th:action="@{/admin/point-bonus}" onsubmit="return confirmPointBonus();">
                <input type="hidden" name="grade" th:value="${selectedGrade}" />
                <input type="number" name="point" placeholder="ν¬μΈνΈ μ…λ ¥" required min="1"/>
                <button type="submit" th:disabled="${selectedGrade == null || selectedGrade.isEmpty()}">λ“±κΈ‰ νμ› ν¬μΈνΈ μ§€κΈ‰</button>
            </form>
            <form action="/admin/order/member-grade-update" method="post">
                <button type="submit">νμ› λ“±κΈ‰ μµμ‹ ν™”</button>
            </form>
        </div>

        <!-- νμ› λ©λ΅ -->
        <div class="member-list">
            <div class="member-item"
                 th:each="member, i : ${memberList}"
                 th:classappend="${member.status.name() == 'DELETED'} ? ' deleted-member' : ''">

                <h3 th:text="'#' + (${currentPage} * ${pageSize} + ${i.index + 1}) + '. ' + ${member.name}"
                    class="member-name"></h3>

                <p><strong>μ΄λ©”μΌ:</strong>
                    <span th:text="${member.email}" class="member-email"></span>
                </p>

                <p><strong>μ—°λ½μ²:</strong>
                    <span class="grade-tag" th:text="${member.contact}"></span>
                </p>

                <p><strong>λ“±κΈ‰:</strong>
                    <span th:text="${member.gradeName}"
                          th:class="'grade-tag ' + ${member.gradeName.toLowerCase()}"></span>
                </p>

                <p><strong>ν¬μΈνΈ:</strong>
                    <span th:text="${member.point}"></span>
                </p>

                <p><strong>μƒνƒ:</strong>
                    <span th:text="${member.status}"></span>
                </p>

                <p><strong>λ§μ§€λ§‰ λ΅κ·ΈμΈ:</strong>
                    <span th:text="${member.lastLoginAt != null ? #temporals.format(member.lastLoginAt, 'yyyy-MM-dd HH:mm') : 'λ―Έμ ‘μ†'}">λ―Έμ ‘μ†</span>
                </p>
            </div>
        </div>

        <!-- β… νμ΄μ§• -->
        <div class="pagination">
            <button th:if="${currentPage > 0}"
                    th:onclick="'location.href=\'/admin/member-list?page=' + (${currentPage} - 1) + '\''">
                β—€ μ΄μ „
            </button>

            <span th:each="i : ${#numbers.sequence(0, lastPageIndex)}">
                <a th:href="@{'/admin/member-list?page=' + ${i}}"
                   th:text="${i + 1}"
                   th:class="${i == currentPage} ? 'active-page' : ''">1</a>
            </span>

            <button th:if="${currentPage < (totalPages > 0 ? totalPages - 1 : 0)}"
                    th:onclick="'location.href=\'/admin/member-list?page=' + (${currentPage} + 1) + '\''">
                λ‹¤μ β–¶
            </button>
        </div>

    </section>
</main>
<th:block layout:fragment="scripts">
    <script th:src="@{/js/admin/member-list.js}"></script>
</th:block>
</body>
</html>