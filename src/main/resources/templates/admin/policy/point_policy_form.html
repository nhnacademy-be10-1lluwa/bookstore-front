<!DOCTYPE html>
<html layout:decorate="~{layout/layout}"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head layout:fragment="head">
  <title>í¬ì¸íŠ¸ ì •ì±… ìƒì„¸</title>
  <meta charset="UTF-8" />
  <link rel="stylesheet" th:href="@{/css/main.css}" />
  <link rel="stylesheet" th:href="@{/css/policy/_policy_form.css}" />
</head>
<body>
<main layout:fragment="content">
  <section class="main-content policy-form-container" style="max-width: 700px; margin: 0 auto;">
    <h1 th:text="${mode == 'new' ? 'ğŸ“ í¬ì¸íŠ¸ ì •ì±… ë“±ë¡' :
                      (mode == 'edit' ? 'ğŸ”§ í¬ì¸íŠ¸ ì •ì±… ìˆ˜ì •' : 'ğŸ” í¬ì¸íŠ¸ ì •ì±… ìƒì„¸')}"></h1>

    <form th:action="${mode == 'new' ? '/admin/policy/point/create' :
                         '/admin/policy/point/' + policyKey + '/update'}"
          th:method="post" th:object="${request}">

      <!-- ë“±ë¡ ëª¨ë“œì¼ ë•Œë§Œ policyKey ì…ë ¥ -->
      <div th:if="${mode == 'new'}" class="form-group" style="margin-bottom: 15px;">
        <label for="policyKeyInput">ì •ì±… ì½”ë“œ (policyKey) <span style="color:red;">*</span></label>
        <input type="text" id="policyKeyInput" name="policyKey" th:field="*{policyKey}"
               class="form-control" placeholder="ì •ì±…ì½”ë“œ ì…ë ¥" required />
      </div>

      <!-- ìˆ˜ì •/ìƒì„¸ ëª¨ë“œì¼ ë•Œë§Œ readonly í‘œì‹œ -->
      <div th:if="${mode != 'new'}" class="form-group" style="margin-bottom: 15px;">
        <label>ì •ì±… ì½”ë“œ (policyKey)</label>
        <input type="text" th:value="${policyKey}" readonly class="form-control"
               style="background-color: #f3f4f6; font-weight: bold; color: #334155;" />
      </div>

      <div class="form-group" th:if="${mode == 'edit'}">
        <label for="statusSwitch">ìƒíƒœ</label>
        <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
          <label class="toggle-switch">
            <input type="checkbox" id="statusSwitch" name="active"
                   th:checked="${request.status.name() == 'ACTIVE'}" th:disabled="${mode == 'view'}"/>
            <span class="slider round"></span>
          </label>
          <span th:text="${request.status.name() == 'ACTIVE' ? 'í™œì„±í™”ë¨' : 'ë¹„í™œì„±í™”ë¨'}" class="status-text"></span>
        </div>
      </div>

      <!-- ì ë¦½ ê°’ -->
      <div class="form-group" style="margin-bottom: 15px;">
        <label>ì ë¦½ ê°’ <span th:if="${mode != 'view'}" style="color:red;">*</span></label>

        <!-- ì½ê¸° ì „ìš©: ë³´ê¸° ëª¨ë“œ -->
        <div th:if="${mode == 'view'}" class="form-control" style="background-color: #f3f4f6;">
          <span th:text="${request.valueType.name() == 'RATE'
              ? request.value.multiply(100).stripTrailingZeros().toPlainString() + '%'
              : #numbers.formatDecimal(request.value, 0, 'COMMA', 2, 'POINT')}"></span>
        </div>

        <input type="number" step="0.01" th:if="${mode != 'view'}"
               th:field="*{value}" class="form-control"
               id="valueInput"
               th:placeholder="${request.valueType?.name() == 'RATE' ? 'ì˜ˆ: 0.5 (0.5%)' : 'ì˜ˆ: 5000 (5,000P)'}"
               required />
      </div>

      <div class="form-group" style="margin-bottom: 15px;">
        <label>ì ë¦½ ìœ í˜• <span style="color:red;">*</span></label>
        <select th:field="*{valueType}" class="form-control"
                th:disabled="${mode == 'view'}"
                id="valueTypeSelect" required>
          <option th:value="AMOUNT">ê¸ˆì•¡</option>
          <option th:value="RATE">ë¹„ìœ¨</option>
        </select>
      </div>

      <!-- ì„¤ëª… -->
      <div class="form-group" style="margin-bottom: 15px;">
        <label>ì„¤ëª…</label>

        <th:block th:if="${mode == 'view'}">
          <textarea th:field="*{description}" class="form-control"
                    readonly rows="4" style="resize: none;"></textarea>
        </th:block>

        <th:block th:unless="${mode == 'view'}">
          <textarea th:field="*{description}" class="form-control"
                    rows="4" style="resize: none;"></textarea>
        </th:block>
      </div>

      <div class="form-buttons" style="display: flex; gap: 10px;">
        <button type="submit" th:if="${mode != 'view'}" class="btn-register">
          <span th:text="${mode == 'new' ? 'ë“±ë¡í•˜ê¸°' : 'ìˆ˜ì •í•˜ê¸°'}">ì €ì¥</span>
        </button>
        <a href="/admin/policy/point" class="btn-delete" style="text-decoration: none; padding: 10px 20px;">
          ëª©ë¡ìœ¼ë¡œ
        </a>
      </div>
    </form>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // ìƒíƒœ í† ê¸€
        const toggle = document.getElementById('statusSwitch');
        const statusText = document.querySelector('.status-text');

        if (toggle && statusText) {
          function updateStatusText() {
            statusText.textContent = toggle.checked ? 'í™œì„±í™”ë¨' : 'ë¹„í™œì„±í™”ë¨';
          }

          updateStatusText();
          toggle.addEventListener('change', updateStatusText);
        }

        // Placeholder ë™ì  ë³€ê²½
        const valueTypeSelect = document.getElementById('valueTypeSelect');
        const valueInput = document.getElementById('valueInput');

        if (valueTypeSelect && valueInput) {
          function updatePlaceholder() {
            const selected = valueTypeSelect.value;
            valueInput.placeholder = selected === 'RATE'
                    ? 'ì˜ˆ: 0.5 (0.5%)'
                    : 'ì˜ˆ: 5000 (5,000P)';
          }

          updatePlaceholder();
          valueTypeSelect.addEventListener('change', updatePlaceholder);
        }
      });
    </script>
  </section>
</main>
</body>
</html>
